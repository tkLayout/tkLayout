  Endcap TEPX {
    phiSegments 4
    etaCut 10
    zError 70

    @include-std CMS_Phase2/Pixel/Materials/disk_TEPX
    @include-std CMS_Phase2/Pixel/Conversions/On_flange/flange_FPIX
    @include-std CMS_Phase2/Pixel/Conversions/On_services_cylinder/stations_serving_TEPX_613
    @include-std CMS_Phase2/Pixel/Materials/Routing/routing_around_TEPX
    
    moduleShape rectangular
    alignEdges false
    numDisks 4
    smallDelta 8
    bigDelta 1.5
    outerRadius 253.95
    numRings 5
    minZ 1616
    //barrelGap 1633.325 // Please activate either minZ (absolute), either barrelGap (relative startZ position from barrel).
    maxZ 2550
    bigParity -1
    smallParity 1
    zRotation 1.570796327
 
    
    Ring 1 {
      moduleSubType 8
      @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2x2_25x100_wide
      @include-std CMS_Phase2/Pixel/Materials/module_TEPX_R1_2x2_2500
      @include-std CMS_Phase2/Pixel/Resolutions/25x100
      numModules 20
      ringOuterRadius 106.35        // From Daniel: so that active sensor Rmin = 62.9 mm. 

      Module 0 {
        // Asym-3R 101
        label "101"
        manualPhiCenterDeg 0.0000000000
        yawAngleFromConfig 0.05235987756
      }
      Module 1 {
        // Sym-3R 102
        label "102"
        manualPhiCenterDeg 18.0000000000
        yawAngleFromConfig 0
      }
      Module 2 {
        // Asym-3R 103
        label "103"
        manualPhiCenterDeg 36.0000000000
        yawAngleFromConfig 0
      }
      Module 3 {
        // Sym-3R 104
        label "104"
        manualPhiCenterDeg 54.0000000000
        yawAngleFromConfig 0
      }
      Module 4 {
        // Asym-3R 105
        label "105"
        manualPhiCenterDeg 72.0000000000
        yawAngleFromConfig 0
      }
      Module 5 {
        // Sym-3R 106
        label "106"
        manualPhiCenterDeg 90.0000000000
        yawAngleFromConfig 0
      }
      Module 6 {
        // Asym-3R 107
        label "107"
        manualPhiCenterDeg 108.0000000000
        yawAngleFromConfig 0
      }
      Module 7 {
        // Sym-3R 108
        label "108"
        manualPhiCenterDeg 126.0000000000
        yawAngleFromConfig 0
      }
      Module 8 {
        // Asym-3R 109
        label "109"
        manualPhiCenterDeg 144.0000000000
        yawAngleFromConfig -0.05235987756
      }
      Module 9 {
        // Sym-3R 110
        label "110"
        manualPhiCenterDeg 162.0000000000
        yawAngleFromConfig 0
      }
      Module 10 {
        // Asym-3R 101
        label "101"
        manualPhiCenterDeg -180.0000000000
        yawAngleFromConfig 0.05235987756
      }
      Module 11 {
        // Sym-3R 102
        label "102"
        manualPhiCenterDeg -162.0000000000
        yawAngleFromConfig 0
      }
      Module 12 {
        // Asym-3R 103
        label "103"
        manualPhiCenterDeg -144.0000000000
        yawAngleFromConfig 0
      }
      Module 13 {
        // Sym-3R 104
        label "104"
        manualPhiCenterDeg -126.0000000000
        yawAngleFromConfig 0
      }
      Module 14 {
        // Asym-3R 105
        label "105"
        manualPhiCenterDeg -108.0000000000
        yawAngleFromConfig 0
      }
      Module 15 {
        // Sym-3R 106
        label "106"
        manualPhiCenterDeg -90.0000000000
        yawAngleFromConfig 0
      }
      Module 16 {
        // Asym-3R 107
        label "107"
        manualPhiCenterDeg -72.0000000000
        yawAngleFromConfig 0
      }
      Module 17 {
        // Sym-3R 108
        label "108"
        manualPhiCenterDeg -54.0000000000
        yawAngleFromConfig 0
      }
      Module 18 {
        // Asym-3R 109
        label "109"
        manualPhiCenterDeg -36.0000000000
        yawAngleFromConfig -0.05235987756
      }
      Module 19 {
        // Sym-3R 110
        label "110"
        manualPhiCenterDeg -18.0000000000
        yawAngleFromConfig 0
      }

    }  
    Disk 1-3 {
      Ring 1 {
        trackingTags pixel,tracker    
      }
    }    
    Disk 4 {
      Ring 1 {
        plotColor 5                  // brown. Different color, since no dedicated tracking tag
      } 
    }
        
    Ring 2 {
      // TODO: There is an exception here: module 1 should be type 10
      moduleSubType 9
      @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2x2_25x100_wide
      @include-std CMS_Phase2/Pixel/Materials/module_TEPX_R2_2x2_2500
      @include-std CMS_Phase2/Pixel/Resolutions/25x100
      trackingTags pixel,tracker
      numModules 28
      ringOuterRadius 144.0          // to be tuned

      Module 0 {
        // Asym-2R Ring 2 module 1 (201) special R3-like
        label "201"
        manualPhiCenterDeg 0.0000000000
        yawAngleFromConfig 0
      }
      Module 1 {
        // Sym-2R Ring 2 module 1 (202)
        label "202"
        manualPhiCenterDeg 12.8571428571
        yawAngleFromConfig 0
      }
      Module 2 {
        // Asym-2R Ring 2 module 2 (203)
        label "203"
        manualPhiCenterDeg 25.5625 
        yawAngleFromConfig 0
      }
      Module 3 {
        // Sym-2R Ring 2 module 2 (204)
        label "204"
        manualPhiCenterDeg 38.5714285714
        yawAngleFromConfig 0
      }
      Module 4 {
        // Asym-2R Ring 2 module 3 (205)
        label "205"
        manualPhiCenterDeg 51.125
        yawAngleFromConfig 0
      }
      Module 5 {
        // Sym-2R Ring 2 module 3 (206)
        label "206"
        manualPhiCenterDeg 64.2857142857
        yawAngleFromConfig 0
      }
      Module 6 {
        // Asym-2R Ring 2 module 4 (207)
        label "207"
        manualPhiCenterDeg 76.6875
        yawAngleFromConfig 0
      }
      Module 7 {
        // Sym-2R Ring 2 module 4 (208)
        label "208"
        manualPhiCenterDeg 90.0000000000
        yawAngleFromConfig 0
      }
      Module 8 {
        // Asym-2R Ring 2 module 5 (209)
        label "209"
        manualPhiCenterDeg 102.25
        yawAngleFromConfig 0
      }
      Module 9 {
        // Sym-2R Ring 2 module 5 (210)
        label "210"
        manualPhiCenterDeg 115.7142857143
        yawAngleFromConfig 0
      }
      Module 10 {
        // Asym-2R Ring 2 module 6 (211)
        label "211"
        manualPhiCenterDeg 127.96
        yawAngleFromConfig 0
      }
      Module 11 {
        // Sym-2R Ring 2 module 6 (212)
        label "212"
        manualPhiCenterDeg 141.4285714286
        yawAngleFromConfig 0
      }
      Module 12 {
        // Asym-2R Ring 2 module 7 (213)
        label "213"
        manualPhiCenterDeg 153.67
        yawAngleFromConfig 0.122173047639603 
      }
      Module 13 {
        // Sym-2R Ring 2 module 7 (214) special R3-like
        label "214"
        manualPhiCenterDeg 167.1428571429
        yawAngleFromConfig 0
      }
      Module 14 {
        // Asym-2R Ring 2 module 1 (201) special R3-like
        label "201"
        manualPhiCenterDeg -180.0000000000
        yawAngleFromConfig 0
      }
      Module 15 {
        // Sym-2R Ring 2 module 1 (202)
        label "202"
        manualPhiCenterDeg -167.1428571429
        yawAngleFromConfig 0
      }
      Module 16 {
        // Asym-2R Ring 2 module 2 (203)
        label "203"
        manualPhiCenterDeg -154.4375
        yawAngleFromConfig 0
      }
      Module 17 {
        // Sym-2R Ring 2 module 2 (204)
        label "204"
        manualPhiCenterDeg -141.4285714286
        yawAngleFromConfig 0
      }
      Module 18 {
        // Asym-2R Ring 2 module 3 (205)
        label "205"
        manualPhiCenterDeg -128.875
        yawAngleFromConfig 0
      }
      Module 19 {
        // Sym-2R Ring 2 module 3 (206)
        label "206"
        manualPhiCenterDeg -115.7142857143
        yawAngleFromConfig 0
      }
      Module 20 {
        // Asym-2R Ring 2 module 4 (207)
        label "207"
        manualPhiCenterDeg -103.3125 
        yawAngleFromConfig 0
      }
      Module 21 {
        // Sym-2R Ring 2 module 4 (208)
        label "208"
        manualPhiCenterDeg -90.0000000000
        yawAngleFromConfig 0
      }
      Module 22 {
        // Asym-2R Ring 2 module 5 (209)
        label "209"
        manualPhiCenterDeg -77.75
        yawAngleFromConfig 0
      }
      Module 23 {
        // Sym-2R Ring 2 module 5 (210)
        label "210"
        manualPhiCenterDeg -64.2857142857
        yawAngleFromConfig 0
      }
      Module 24 {
        // Asym-2R Ring 2 module 6 (211)
        label "211"
        manualPhiCenterDeg -52.04
        yawAngleFromConfig 0
      }
      Module 25 {
        // Sym-2R Ring 2 module 6 (212)
        label "212"
        manualPhiCenterDeg -38.5714285714
        yawAngleFromConfig 0
      }
      Module 26 {
        // Asym-2R Ring 2 module 7 (213)
        label "213"
        manualPhiCenterDeg -26.33
        yawAngleFromConfig 0.122173047639603 
      }
      Module 27 {
        // Sym-2R Ring 2 module 7 (214) special R3-like
        label "214"
        manualPhiCenterDeg -12.8571428571
        yawAngleFromConfig 0
      }

      Module 0 {
        moduleSubType 10
        plotColor 1 // blue, to highlight the special type 
      }
      Module 13-14 {
        moduleSubType 10
        plotColor 1 // blue, to highlight the special type 
      }
      Module 27 {
        moduleSubType 10
        plotColor 1 // blue, to highlight the special type 
      }
      Module 1-12 {
        moduleSubType 9
        plotColor 10 // usual quad-module color
      }
      Module 15-26 {
        moduleSubType 9
        plotColor 10 // usual quad-module color
      }
    }
    
    Ring 3 {
      moduleSubType 10
      @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2x2_25x100_wide
      @include-std CMS_Phase2/Pixel/Materials/module_TEPX_R3_2x2_2500
      @include-std CMS_Phase2/Pixel/Resolutions/25x100
      trackingTags pixel,tracker
      numModules 36
      ringOuterRadius 181.3          // to be tuned
      Module 0 { label "301" }
      Module 1 { label "302" }
      Module 2 { label "303" }
      Module 3 { label "304" }
      Module 4 { label "305" }
      Module 5 { label "306" }
      Module 6 { label "307" }
      Module 7 { label "308" }
      Module 8 { label "309" }
      Module 9 { label "310" }
      Module 10 { label "311" }
      Module 11 { label "312" }
      Module 12 { label "313" }
      Module 13 { label "314" }
      Module 14 { label "315" }
      Module 15 { label "316" }
      Module 16 { label "317" }
      Module 17 { label "318" }
      Module 18 { label "301" }
      Module 19 { label "302" }
      Module 20 { label "303" }
      Module 21 { label "304" }
      Module 22 { label "305" }
      Module 23 { label "306" }
      Module 24 { label "307" }
      Module 25 { label "308" }
      Module 26 { label "309" }
      Module 27 { label "310" }
      Module 28 { label "311" }
      Module 29 { label "312" }
      Module 30 { label "313" }
      Module 31 { label "314" }
      Module 32 { label "315" }
      Module 33 { label "316" }
      Module 34 { label "317" }
      Module 35 { label "318" }
    }
    
    Ring 4 {
      moduleSubType 11
      @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2x2_25x100_wide
      @include-std CMS_Phase2/Pixel/Materials/module_TEPX_R4_2x2_2500
      @include-std CMS_Phase2/Pixel/Resolutions/25x100
      trackingTags pixel,tracker
      numModules 44
      ringOuterRadius 217.9           // to be tuned
      yawFlip true
      Module 0 { label "401" }
      Module 1 { label "402" }
      Module 2 { label "403" }
      Module 3 { label "404" }
      Module 4 { label "405" }
      Module 5 { label "406" }
      Module 6 { label "407" }
      Module 7 { label "408" }
      Module 8 { label "409" }
      Module 9 { label "410" }
      Module 10 { label "411" }
      Module 11 { label "412" }
      Module 12 { label "413" }
      Module 13 { label "414" }
      Module 14 { label "415" }
      Module 15 { label "416" }
      Module 16 { label "417" }
      Module 17 { label "418" }
      Module 18 { label "419" }
      Module 19 { label "420" }
      Module 20 { label "421" }
      Module 21 { label "422" }
      Module 22 { label "401" }
      Module 23 { label "402" }
      Module 24 { label "403" }
      Module 25 { label "404" }
      Module 26 { label "405" }
      Module 27 { label "406" }
      Module 28 { label "407" }
      Module 29 { label "408" }
      Module 30 { label "409" }
      Module 31 { label "410" }
      Module 32 { label "411" }
      Module 33 { label "412" }
      Module 34 { label "413" }
      Module 35 { label "414" }
      Module 36 { label "415" }
      Module 37 { label "416" }
      Module 38 { label "417" }
      Module 39 { label "418" }
      Module 40 { label "419" }
      Module 41 { label "420" }
      Module 42 { label "421" }
      Module 43 { label "422" }
    }
    
    Ring 5 {
      moduleSubType 12
      @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2x2_25x100_wide
      @include-std CMS_Phase2/Pixel/Materials/module_TEPX_R5_2x2_2500
      @include-std CMS_Phase2/Pixel/Resolutions/25x100
      trackingTags pixel,tracker
      numModules 48
      ringOuterRadius 253.95          // ????? So that active  Rmax < 254.52 mm, is that the right constraint?
      yawFlip true
      Module 0 { label "501" }
      Module 1 { label "502" }
      Module 2 { label "503" }
      Module 3 { label "504" }
      Module 4 { label "505" }
      Module 5 { label "506" }
      Module 6 { label "507" }
      Module 7 { label "508" }
      Module 8 { label "509" }
      Module 9 { label "510" }
      Module 10 { label "511" }
      Module 11 { label "512" }
      Module 12 { label "513" }
      Module 13 { label "514" }
      Module 14 { label "515" }
      Module 15 { label "516" }
      Module 16 { label "517" }
      Module 17 { label "518" }
      Module 18 { label "519" }
      Module 19 { label "520" }
      Module 20 { label "521" }
      Module 21 { label "522" }
      Module 22 { label "523" }
      Module 23 { label "524" }
      Module 24 { label "501" }
      Module 25 { label "502" }
      Module 26 { label "503" }
      Module 27 { label "504" }
      Module 28 { label "505" }
      Module 29 { label "506" }
      Module 30 { label "507" }
      Module 31 { label "508" }
      Module 32 { label "509" }
      Module 33 { label "510" }
      Module 34 { label "511" }
      Module 35 { label "512" }
      Module 36 { label "513" }
      Module 37 { label "514" }
      Module 38 { label "515" }
      Module 39 { label "516" }
      Module 40 { label "517" }
      Module 41 { label "518" }
      Module 42 { label "519" }
      Module 43 { label "520" }
      Module 44 { label "521" }
      Module 45 { label "522" }
      Module 46 { label "523" }
      Module 47 { label "524" }
    }
    
    Disk 1 { placeZ 1750.00 }
    Disk 2 { placeZ 2009.59 }
    Disk 3 { placeZ 2307.69 }
    Disk 4 { placeZ 2650.00 }

    Disk 1 { destination FPIX9 }
    Disk 2 { destination FPIX10 }
    Disk 3 { destination FPIX11 }
    Disk 4 { destination FPIX12 }
  }

